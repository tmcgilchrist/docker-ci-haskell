#!/bin/sh -eux

REPO="tmcgilchrist/ci-haskell"
BASE_TAG="ubuntu_xenial-${GHCVER}_${CABALVER}"

bin/ci.branches

if [ "${TRAVIS_BRANCH}" = 'master' ]; then
  docker login -u ${DOCKER_USER} -p ${DOCKER_PASS}

  for tag in "${BASE_TAG}" "${BASE_TAG}-$(cat data/version)"; do
    docker push "${REPO}:${tag}"
  done
fi
